<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Time Zone Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #eef2fb;
            --surface: rgba(255, 255, 255, 0.9);
            --shadow: 0 10px 30px rgba(27, 52, 105, 0.12);
            --text-main: #1f2937;
            --text-muted: #4b5563;
            --divider: rgba(15, 23, 42, 0.08);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Manrope', sans-serif;
            background: radial-gradient(circle at 20% 20%, #f7f9ff 0%, #eef2fb 40%, #e3e9f8 100%);
            margin: 0;
            min-height: 100vh;
            color: var(--text-main);
            padding: 32px;
        }

        .page { max-width: 1100px; margin: 0 auto; }

        /* --- Header & Controls --- */
        .top-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 18px;
        }

        h1 { margin: 0; font-size: 1.9rem; letter-spacing: -0.02em; }
        .subtitle { color: var(--text-muted); font-size: 0.95rem; }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 12px;
        }

        button {
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #3b82f6, #3451f1);
            color: white;
            box-shadow: 0 4px 12px rgba(52, 81, 241, 0.2);
            transition: all 0.2s ease;
        }
        
        button:hover { transform: translateY(-2px); }
        button:active { transform: translateY(0); }

        /* --- Card Layout --- */
        .clock-layout {
            background: linear-gradient(180deg, var(--surface), rgba(255, 255, 255, 0.85));
            border-radius: 18px;
            padding: 22px 18px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(52, 81, 241, 0.08);
        }

        .clock-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .clock-card {
            background: #fff;
            padding: 22px 20px 18px;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            min-width: 240px;
            flex: 1;
            border-top: 6px solid #ccc;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .clock-card:active { cursor: grabbing; }
        .clock-card.dragging { opacity: 0.5; transform: scale(0.95); }
        .drop-target { border: 2px dashed #3451f1; }

        /* City Accents */
        .adelaide { border-color: #ff7043; }
        .canberra { border-color: #3451f1; }
        .brisbane { border-color: #22c55e; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .city-name { font-weight: 700; color: var(--text-muted); text-transform: uppercase; font-size: 0.9rem; letter-spacing: 0.05em; }
        
        .drag-handle { 
            color: #cbd5e1; 
            cursor: grab; 
            padding: 4px;
            font-size: 1.2rem;
        }

        .time-display {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--text-main);
            margin: 10px 0;
            font-variant-numeric: tabular-nums; /* Prevents jitter when numbers change */
        }

        .date-display { font-size: 1rem; color: #1d4ed8; font-weight: 600; }
        .timezone-code { font-size: 0.85rem; color: #9ca3af; margin-top: 4px; }

        .divider { height: 1px; background: var(--divider); margin: 15px 0; }

        .meta-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; }
        
        .badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 700;
            background: #f1f5f9;
            color: #64748b;
        }
        
        .badge.dst-on { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
        
        .icon-btn {
            background: transparent;
            border: 1px solid #e2e8f0;
            color: #64748b;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
        }
        
        .icon-btn:hover { background: #f8fafc; color: #334155; border-color: #cbd5e1; }

        @media (max-width: 720px) {
            .clock-container { flex-direction: column; }
            .clock-card { width: 100%; }
        }
    </style>
</head>
<body>

    <div class="page">
        <div class="top-bar">
            <div class="title-wrap">
                <h1>Australian Time Dashboard</h1>
                <div class="subtitle">Live local times across AUS</div>
            </div>
        </div>

        <div class="controls">
            <button id="toggle-format">Switch to 24h</button>
            <button id="reset-order" style="background: #64748b;">Reset Order</button>
        </div>

        <div class="clock-layout">
            <div class="clock-container" id="card-container">
                <div class="clock-card adelaide" id="card-adelaide" draggable="true" data-city="adelaide">
                    <div class="card-header">
                        <div class="city-name">Adelaide</div>
                        <div class="drag-handle">â‹®â‹®</div>
                    </div>
                    <div id="time-adelaide" class="time-display">--:--</div>
                    <div id="date-adelaide" class="date-display">...</div>
                    <div id="code-adelaide" class="timezone-code">...</div>
                    <div class="divider"></div>
                    <div class="meta-row">
                        <div id="offset-adelaide" class="badge">UTC</div>
                        <div id="dst-adelaide" class="badge">DST</div>
                    </div>
                    <button class="icon-btn" data-copy="adelaide">ðŸ“‹ Copy Time</button>
                </div>

                <div class="clock-card canberra" id="card-canberra" draggable="true" data-city="canberra">
                    <div class="card-header">
                        <div class="city-name">Canberra</div>
                        <div class="drag-handle">â‹®â‹®</div>
                    </div>
                    <div id="time-canberra" class="time-display">--:--</div>
                    <div id="date-canberra" class="date-display">...</div>
                    <div id="code-canberra" class="timezone-code">...</div>
                    <div class="divider"></div>
                    <div class="meta-row">
                        <div id="offset-canberra" class="badge">UTC</div>
                        <div id="dst-canberra" class="badge">DST</div>
                    </div>
                    <button class="icon-btn" data-copy="canberra">ðŸ“‹ Copy Time</button>
                </div>

                <div class="clock-card brisbane" id="card-brisbane" draggable="true" data-city="brisbane">
                    <div class="card-header">
                        <div class="city-name">Brisbane</div>
                        <div class="drag-handle">â‹®â‹®</div>
                    </div>
                    <div id="time-brisbane" class="time-display">--:--</div>
                    <div id="date-brisbane" class="date-display">...</div>
                    <div id="code-brisbane" class="timezone-code">...</div>
                    <div class="divider"></div>
                    <div class="meta-row">
                        <div id="offset-brisbane" class="badge">UTC</div>
                        <div id="dst-brisbane" class="badge">DST</div>
                    </div>
                    <button class="icon-btn" data-copy="brisbane">ðŸ“‹ Copy Time</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Configuration
        const cities = [
            { id: 'adelaide', zone: 'Australia/Adelaide' },
            { id: 'canberra', zone: 'Australia/Canberra' },
            { id: 'brisbane', zone: 'Australia/Brisbane' }
        ];

        let useHour12 = true;
        
        // 1. PERFORMANCE: Cache formatters so we don't recreate them every second
        const formatters = {};
        
        function rebuildFormatters() {
            cities.forEach(city => {
                formatters[city.id] = {
                    time: new Intl.DateTimeFormat('en-AU', {
                        timeZone: city.zone, hour12: useHour12, 
                        hour: '2-digit', minute: '2-digit'
                    }),
                    date: new Intl.DateTimeFormat('en-AU', {
                        timeZone: city.zone, weekday: 'short', day: 'numeric', month: 'short'
                    }),
                    parts: new Intl.DateTimeFormat('en-AU', {
                        timeZone: city.zone, timeZoneName: 'short'
                    })
                };
            });
        }
        
        // Initial build
        rebuildFormatters();

        // 2. LOGIC: Helper to get offset minutes efficiently
        function getOffsetMinutes(date, timeZone) {
            // Using a specific date to check offset is safer than parts parsing in a loop
            const tzDate = new Date(date.toLocaleString("en-US", {timeZone}));
            const utcDate = new Date(date.toLocaleString("en-US", {timeZone: "UTC"}));
            return (tzDate - utcDate) / 60000;
        }

        function isDstActive(now, cityZone) {
            // Simple check: Compare current offset vs June (Winter/Standard) offset
            const currentOffset = getOffsetMinutes(now, cityZone);
            const juneDate = new Date(now.getFullYear(), 5, 1); // June 1st
            const standardOffset = getOffsetMinutes(juneDate, cityZone);
            return currentOffset > standardOffset;
        }

        function updateClocks() {
            const now = new Date();

            cities.forEach(city => {
                // Use cached formatters
                const fmt = formatters[city.id];
                
                const timeString = fmt.time.format(now);
                const dateString = fmt.date.format(now);
                
                // Extract timezone code (e.g., ACDT)
                const parts = fmt.parts.formatToParts(now);
                const tzName = parts.find(part => part.type === 'timeZoneName').value;

                // Update DOM
                document.getElementById(`time-${city.id}`).textContent = timeString;
                document.getElementById(`date-${city.id}`).textContent = dateString;
                document.getElementById(`code-${city.id}`).textContent = tzName;

                // Offset and DST
                const offsetMinutes = getOffsetMinutes(now, city.zone);
                const isDst = isDstActive(now, city.zone);
                
                // Format Offset
                const sign = offsetMinutes >= 0 ? '+' : '-';
                const h = Math.floor(Math.abs(offsetMinutes) / 60);
                const m = Math.abs(offsetMinutes) % 60;
                const offsetString = `UTC ${sign}${h}:${m.toString().padStart(2, '0')}`;

                document.getElementById(`offset-${city.id}`).textContent = offsetString;
                
                const dstBadge = document.getElementById(`dst-${city.id}`);
                dstBadge.textContent = isDst ? 'DST ON' : 'Standard';
                dstBadge.className = isDst ? 'badge dst-on' : 'badge';
            });
        }

        // Start Loop
        updateClocks();
        setInterval(updateClocks, 1000);

        // --- Event Listeners ---

        document.getElementById('toggle-format').addEventListener('click', (e) => {
            useHour12 = !useHour12;
            e.target.textContent = useHour12 ? 'Switch to 24h' : 'Switch to 12h';
            rebuildFormatters(); // Rebuild formatters with new hour setting
            updateClocks();
        });

        document.querySelectorAll('[data-copy]').forEach(btn => {
            btn.addEventListener('click', () => {
                const cityId = btn.getAttribute('data-copy');
                const text = document.getElementById(`time-${cityId}`).textContent;
                navigator.clipboard.writeText(text);
                
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ“ Copied';
                setTimeout(() => btn.innerHTML = originalText, 1000);
            });
        });

        // --- Drag & Drop with Persistence ---

        const container = document.getElementById('card-container');
        let draggedItem = null;

        // 1. Load saved order on startup
        const savedOrder = JSON.parse(localStorage.getItem('clockOrder'));
        if (savedOrder) {
            savedOrder.forEach(id => {
                const card = document.getElementById(`card-${id}`);
                if (card) container.appendChild(card);
            });
        }

        // 2. Drag Logic
        container.addEventListener('dragstart', (e) => {
            draggedItem = e.target;
            e.target.classList.add('dragging');
        });

        container.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
            draggedItem = null;
            saveOrder(); // Save new order
        });

        container.addEventListener('dragover', (e) => {
            e.preventDefault();
            const afterElement = getDragAfterElement(container, e.clientY);
            if (afterElement == null) {
                container.appendChild(draggedItem);
            } else {
                container.insertBefore(draggedItem, afterElement);
            }
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.clock-card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function saveOrder() {
            const currentCards = [...container.querySelectorAll('.clock-card')];
            const ids = currentCards.map(card => card.getAttribute('data-city'));
            localStorage.setItem('clockOrder', JSON.stringify(ids));
        }

        document.getElementById('reset-order').addEventListener('click', () => {
            localStorage.removeItem('clockOrder');
            location.reload();
        });

    </script>
</body>
</html>